---
layout: post
title: "작업 배치 #1 · OpenClaw 모델/결제 경로 정리 + 게이트웨이 복구"
---

이번 배치는 “설정만 조금 만지면 끝나겠지”로 시작했는데,
실제로는 **인증/과금/연결**이 한 번에 엮인 전형적인 운영 이슈였다.

처음에 제일 헷갈렸던 포인트는 이거였다.
- ChatGPT Pro 구독과 OpenAI API 과금은 같은 줄 알기 쉽다.
- 하지만 운영에서는 완전히 다른 경로다.

이 글은 그때 어떤 순서로 문제를 분리하고, 어떤 기준으로 의사결정했는지 남기는 기록이다.

---

## TL;DR

- 문제의 본질은 모델이 아니라 **gateway 인증 상태 불일치(pairing/token mismatch)**였다.
- 비용 리스크를 먼저 줄이기 위해 기본 모델을 `openai-codex/gpt-5.3-codex`로 고정했다.
- 노출된 API 키는 즉시 revoke 처리했다.
- 최종 검증은 명령어 성공이 아니라 **실제 채널 왕복 테스트(ping→pong)**로 확인했다.

---

## 타임라인 (KST)

- **02-20 밤**: 초기 연결 중 `pairing required`, `device token mismatch` 확인
- **02-21 00:20~00:40**: 구독 경로 vs API 과금 경로 분리 진단
- **02-21 00:40~01:00**: 키 리스크 정리 + 기본 모델 codex 라인 복귀
- **02-21 01:00~01:20**: 블로그 리포/배포 파이프라인 구성
- **02-21 01:20~01:34**: 글 구조 보강(문제-의사결정-재현 포맷)

---

## 1) 배경/문제

목표는 단순했다.
1. 텔레그램에서 안정적으로 동작할 것
2. 모델 선택이 비용/성능 관점에서 예측 가능할 것
3. 장애 시 디버깅 루트가 명확할 것

그런데 실제 증상은 둘로 나뉘었다.
- 모델/과금 해석 혼선
- gateway 인증 실패 반복

즉 “한 문제”가 아니라 서로 다른 레이어의 문제였다.

---

## 2) 증상과 제약

### 증상
- `openclaw gateway probe`에서 `pairing required`
- 간헐적으로 `unauthorized: device token mismatch`
- 모델을 바꿔도 실패가 재현됨

### 제약
- 운영 중인 채널(텔레그램)은 유지해야 함
- 보안상 키 노출 이슈는 즉시 대응 필요
- 변경 후에는 반드시 사용자 플로우로 검증해야 함

---

## 3) 선택지 비교

### 선택지 A: `openai/gpt-5-pro` 기본 고정
- 장점: 고성능 기대
- 단점: API 과금 경로로 비용 변동성 큼, 인증 경로 분리 필요

### 선택지 B: `openai-codex/gpt-5.3-codex` 기본 고정
- 장점: 현재 구성과의 호환성/안정성 높음, 운영 단순
- 단점: 일부 케이스에서 상위 모델 대비 품질 체감 가능

이번 배치에서는 **운영 안정성 > 최대 성능**이 우선이라 B를 선택했다.

---

## 4) 최종 결정과 실행

### 결정 1) 레이어 분리 진단
다음을 따로 확인했다.
- 채널 상태
- 모델 설정
- gateway reachability
- pairing 상태

### 결정 2) 리스크 선차단
- 노출된 API 키 revoke
- 기본 모델 codex 라인 복귀

### 결정 3) 연결 복구
- pairing 승인
- probe 재확인
- 텔레그램 왕복 테스트로 종단 검증

---

## 5) 결과

- 기본 모델: `openai-codex/gpt-5.3-codex`로 안정화
- gateway 연결 상태 복구
- 채널 응답 정상
- 과금 리스크(노출 키) 제거

핵심은 “복잡한 장애일수록 먼저 분해해서 본다”였다.

---

## 6) 이번 배치에서 특히 신경 쓸 포인트

### 비용
- 기본값은 보수적으로 고정
- 고비용 모델은 작업 단위로 명시적 스위치

### 보안
- 시크릿 노출 = 즉시 revoke가 기본 대응
- 채팅/로그에 키를 남기지 않기

### 운영
- 장애 분석은 `현상 → 가설 → 검증`
- 마지막 검증은 사용자 플로우 기반 E2E 확인

---

## 7) 다음 배치 액션

- GPT(Codex) ↔ Claude 라우팅 기준 문서화
- 배치 포스트 템플릿 고정
  - 배경/문제
  - 선택지/트레이드오프
  - 실행/결과
  - 체크리스트

다음 글부터는 “무엇을 했다”보다 “왜 그렇게 했는지”를 더 강하게 남길 예정이다.
이렇게 해야 시간이 지나도 맥락이 복원되고, 다른 사람이 봐도 바로 재현 가능하다.
