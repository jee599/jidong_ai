---
layout: post
title: "작업 배치 #1 · OpenClaw 모델/결제 경로 정리 + 게이트웨이 복구"
---

이번 배치는 단순한 설정 작업처럼 보였지만,
실제로는 **인증 경로**, **과금 경로**, **운영 안정성**이 한 번에 얽힌 문제였다.

핵심은 하나였다.
> "지금 어떤 레이어에서 문제가 나는지(구독/API/게이트웨이) 분리해서 본다."

---

## 프로젝트 진행 요약 (한눈에)

### 목표
- 텔레그램 기반 OpenClaw를 안정적으로 운영
- 불필요한 API 과금 리스크 제거
- 모델 전략을 실무적으로 고정

### 결과
- 기본 모델: `openai-codex/gpt-5.3-codex`로 안정화
- OpenAI API 키 노출분 revoke 처리
- gateway pairing/token mismatch 이슈 복구
- 텔레그램 왕복 테스트 정상 확인 (`ping → pong`)

---

## 실제로 부딪힌 문제

### 1) 결제/모델 경로 혼선
처음에는 "ChatGPT Pro 결제 = 모든 GPT 모델 사용 가능"로 이해하기 쉬운데,
운영 관점에선 아래처럼 분리된다.

- **구독 경로**: ChatGPT/Codex OAuth
- **API 경로**: OpenAI Platform API key + 사용량 과금

여기서 경계를 명확히 못 잡으면,
원치 않는 비용이 발생하거나 인증 실패 디버깅 시간이 길어진다.

### 2) gateway 연결 실패
증상:
- `pairing required`
- `unauthorized: device token mismatch`

즉, 모델 문제가 아니라 **디바이스 인증 상태 불일치**가 본질 이슈였다.

---

## 접근 방식 (재현 가능한 순서)

### Step 1. 레이어 분리 진단
문제를 한 덩어리로 보지 않고 분리했다.

- 채널 상태(telegram)
- 모델 설정(primary)
- gateway reachability/probe
- pairing 상태

### Step 2. 리스크 우선 차단
- 노출된 API 키 revoke
- 기본 모델을 codex 라인으로 복귀해 비용/운영 안정성 확보

### Step 3. 연결 복구
- pairing 승인
- probe 재확인
- 실제 메시지 왕복으로 검증

---

## 여기서 특히 신경 써야 하는 포인트

### A. 비용 관리
- 기본 모델은 안정/저비용 라인으로 고정
- 고비용 모델은 작업 단위로 명시적 스위치
- 키는 절대 채팅/로그에 노출하지 않기

### B. 운영 안정성
- 장애 시 반드시 `현상 → 가설 → 검증` 순서 유지
- "모델 문제"로 단정하지 말고 gateway/auth부터 확인
- 마지막 검증은 항상 실제 채널 왕복 테스트로 마무리

### C. 협업/회고 품질
나중에 다시 봐도 이해되게 기록하려면,
"무엇을 했는가"보다 "왜 그렇게 했는가"를 함께 남겨야 한다.

---

## 이번 배치에서 얻은 실무 규칙

1. 인증/과금/런타임은 분리해서 본다.
2. 기본값은 보수적으로, 실험은 명시적으로.
3. 시크릿 노출은 "즉시 폐기"가 기본 대응.
4. 성공 기준은 명령어 결과 + 실제 사용자 플로우 통과.

---

## 다음 배치에 이어갈 것

- GPT(Codex) ↔ Claude 스위칭 운영 기준 수립
- 작업 단위별 블로그 템플릿 정교화
  - 문제 맥락
  - 의사결정 근거
  - 재현 절차
  - 주의 포인트

이 포맷을 유지하면,
나중에 내가 보더라도 바로 맥락이 복원되고,
다른 사람이 봐도 "어디서 실수하기 쉬운지"를 빠르게 파악할 수 있다.
